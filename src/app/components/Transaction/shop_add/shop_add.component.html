<div class="contain-inter" style="height: fit-content;" >
    <app-cashier-dialog (returnResult)="getSalesDetail($event)" [isModalVisible]="isModalVisible" [dialogData]="selectedSales"></app-cashier-dialog>
   
    <style>
        .TBfont {
            font-size: 20px
        }

        .TBcenter {
            text-align: center;
        }

        .TBright {
            text-align: right;
        }
    </style>
    <div style="width:100%;display:inline-block;border-bottom: orangered 1px solid;">
        <button id="round" nzShape="circle" nz-button nzType="primary" (click)="reset();init()">
            <i nz-icon nzType="reload"></i></button>
        <button nz-button nzType="primary" (click)="swap()">
            <span nz-icon nzType="swap" nzTheme="outline"></span></button>   
        <button nz-button nzType="primary" (click)="changeToStall()">小吃部
                <span nz-icon nzType="swap" nzTheme="outline"></span></button>               
        <h1 style="float:left;"><span>{{pageTitle}}</span></h1>
        <div style="float:right;">
            <div nz-row style="display: flex;width: 100%;margin-top: 10px;">
                <label class="displayText">Date / 日期 :</label>
                <label style="font-size :18px;">{{date}}</label>
            </div>
            <div nz-row style="display: flex;width: 100%;margin-top: 10px;">
                <label class="displayText">Receipt No :</label>
                <label style="font-size :18px;color:red">{{receiptNo}}</label>
            </div>             
        </div> 
    </div>   
    <div class="tableShow-area"  style="height: fit-content;">  
        <div nz-row>
            <div nz-col nzFlex="3">
                <div style="padding:5px" style="padding: 10px;">
                    <div nz-row style="display: flex;width: 100%;">
                        <div style="width: 85%;">                            
                            <div style="display: flex;">
                                <!-- <div style="width:70%;margin-right: 5%;">
                                    <label class="displayText">Product Code / 货名 :</label>                                            
                                    <nz-form-item>
                                        <nz-form-control nzErrorTip="Code is required!">
                                            <nz-input-group 
                                            [nzAddOnAfter]="suffixButton"> 
                                                <nz-select                                   
                                                id="itemcode"  nzShowSearch class="inputWidth" 
                                                [(ngModel)]="item_code"
                                                (keydown.control.enter)="InputChange($event)"
                                                (keyup.enter)="InputChange($event)"                 
                                                    nzPlaceHolder="Select a Product">
                                                    <ng-container  *ngFor="let p of Products, let i = index">
                                                        <nz-option *ngIf="ProductLoadSel" [nzValue]="i" [nzLabel]="p.code + '-' + p.name"></nz-option>
                                                    </ng-container>
                                                    <nz-option *ngIf="!ProductLoadSel" nzDisabled nzCustomContent>
                                                        <i nz-icon nzType="loading" class="loading-icon"></i> Loading Data...
                                                    </nz-option>
                                                </nz-select>       
                                            </nz-input-group>
                                            <ng-template #suffixButton>
                                                <button nzType="primary" nz-button
                                                        (click)="searchAndAdd(false)">Search</button>
                                            </ng-template>
                                        </nz-form-control>
                                    </nz-form-item>
                                </div> -->
                                <div style="width:70%;margin-right: 5%;">
                                    <label class="displayText">Product Code / 货名 :</label>
                                    <input style="width:80%" nz-input id="itemcode" [(ngModel)]="item_code"
                                        (keydown.control.enter)="InputChange($event)"
                                        (keyup.enter)="InputChange($event)" />                                    
                                    <button style="width:20%" nz-button nzType="primary" (click)="searchAndAdd(false)">
                                        <span nz-icon nzType="search" nzTheme="outline"></span></button>  
                                </div>
                                <div style="float:right">
                                    <nz-button-group  class="tableBut">
                                        <button nzType="primary" id="addItembtn" nz-button
                                            (click)="addItems(item_code,item_quantity,item_unit_cost,item_sellingPrice)">Add
                                            Item</button>
                                    </nz-button-group>
                                </div>
                            </div>
                            <nz-select id="productItems" nzShowSearch class="inputWidth" [(ngModel)]="item_index"
                                (ngModelChange)="ItemChange($event)" nzPlaceHolder="Select a Solution">
                                <ng-container *ngFor="let p of Products; let i = index">Items
                                    <nz-option *ngIf="!ProductLoadSel" [nzValue]="i" [nzLabel]="p.code + '-' + p.name">
                                    </nz-option>
                                </ng-container>
                            </nz-select>
                        </div>
                    </div>
                    <div nz-row style="display: flex;width: 100%;margin-top: 10px;">
                        <div style="width:50%">
                            <label class="displayText">Unit Price / 单价 ：</label>
                            <nz-input-group nzSuffix="MYR" nzPrefix="RM">
                                <input nz-input type="number" id="itemPrice" (change)="calTotal($event)" (keyup.enter)="addItems(item_code,item_quantity,item_unit_cost,item_sellingPrice)"  [(ngModel)]="item_unit_cost" />
                            </nz-input-group>
                        </div>
                        <div style="width:50%">
                            <label class="displayText">Quantity / 数量 ：</label>
                            <input nz-input type="number" id="itemquantity" class="inputWidth"
                                (change)="calTotal($event)" [(ngModel)]="item_quantity" (keyup.enter)="addItemListEvent()" />
                        </div>
                    </div>
                </div>
                <div class="tableShow-table" style="padding:10px;min-width:50%;border-top: 2px solid grey;">
                    <div style="width: 100%;">
                        <div style="width: 100%;">
                            <h2 style="float:left"><span *ngIf="total" style="float:left;">Gross Total : RM
                                    {{total}}</span>
                                <span *ngIf="!total">Gross Total : RM 0.00</span>
                            </h2>
                        </div>
                        <div style="width: 100%;float:right">
                            <h2 style="float:left"><span *ngIf="discount" style="float:left;">Discount : RM
                                    {{discount}}</span>
                                <span *ngIf="!discount">Discount : RM 0.00</span>
                            </h2>
                        </div>
                        <div style="width: 100%;float:right">
                            <h1><span *ngIf="total">Total : RM {{total}}</span>
                                <span *ngIf="!total">Total : RM 0.00</span>
                            </h1>
                            <button id="receipt" nzType="primary" nz-button (click)="printReceipt()" *ngIf="previousSales">Print Receipt</button>
                            <button nz-button id="kickOpen" nzType="primary" onclick="kickOpen=false;writeonSer('1')" *ngIf="kickOpen">Kick Open</button>
                            <button nz-button id="kickOpenDrawer" nzType="primary" onclick="writeonSer('1')" style="display:none">Open Drawer</button>
                        </div>
                    </div>
                </div>
            </div>
            <div nz-col nzFlex="2" class="butArea"
                style="min-width:50%;border: 2px solid grey;  margin-top: 10px;height:fit-content">

                <nz-table [nzScroll]="{ y: '500px' }" [nzData]="OrderItems" nzBordered nzSize="small"
                    nzHideOnSinglePage="true" [nzFrontPagination]="false" [nzNoResult]="emptyTemplate"
                    style="min-height: 50vh">
                    <ng-template #emptyTemplate>
                        <tr style="height:fit-content">
                            <nz-empty *ngIf="NoResultId=='No Data'" nzNotFoundImage="simple"></nz-empty>
                            <nz-empty *ngIf="NoResultId=='No Result'"
                                nzNotFoundImage="https://gw.alipayobjects.com/zos/antfincdn/ZHrcdLPrvN/empty.svg"
                                [nzNotFoundContent]="contentTpl">
                                <ng-template #contentTpl>
                                    <span> {{NoResultId}} </span>
                                </ng-template>
                            </nz-empty>
                        </tr>
                    </ng-template>
                    <thead>
                        <tr style="text-align: center;font-size:15px">
                            <td colspan="5">
                                Item Count : {{itemCount}}
                            </td>
                        </tr>
                        <tr>
                            <ng-container *ngFor="let p of order_product">
                                <th class="firstTh" style="text-align: center;z-index: 20;" [colspan]="1">
                                    {{p}}
                                </th>
                            </ng-container>
                        </tr>
                    </thead>
                    <tbody>


                        <ng-container *ngFor="let p of order_items.order_item,let i = index">
                            <tr>
                                <td class="TBfont">
                                    {{p.itemId}} - {{p.itemName}}
                                </td>
                                <td class="TBright">
                                    {{p.unitPrice}}
                                </td>
                                <td class="TBcenter">
                                    {{p.quantity}}
                                </td>
                                <td class="TBfont TBright">
                                    {{p.sellingPrice}}
                                </td>
                                <td class="TBcenter">
                                    <button nzType="primary" nz-button
                                        (click)="deleteItem(i, p.quantity)">Delete</button>

                                </td>

                            </tr>
                        </ng-container>

                    </tbody>
                </nz-table>
            </div>
        </div>
    </div>
</div>